ticket-flow
2025 02 ~ 진행중
개인 프로젝트
사용기술 : Spring Boot, JAVA, MySql, JPA,
Redis, RabbitMQ, IntelliJ IDEA, Locust
공연장 티켓 판매 시스템에서 발생할 수 있는 재고(좌석) 동시 접근 이슈
를 해결하기 위한 목적으로 진행되었습니다. 실제 서비스 환경에서는 다
수의 사용자가 동시에 동일 좌석에 접근함에 따라, 재고가 음수로 떨어
지거나 일관성 없는 상태가 발생할 위험이 존재합니다. 따라서, 안정적
이고 효율적인 재고 관리를 위해 여러 가지 방법을 고려하며 부하 테스
트를 진행해 가며 동시성 제어 및 비동기 처리 기술을 적절히 조합한 솔
루션을 도입하게 되었습니다.

![image](https://github.com/user-attachments/assets/1b544f6f-23c6-40f1-ba14-3a8f2f260889)


비관적락을 선택 : 초기에는 낙관적 락을 적용해보고자 하였으나, 대규모 동시 접근 상황에서 충돌이 빈번하게 발생하는 문제를 테스트 결과로 확인하였습니다. 낙관적 락은 충돌
이 적은 환경에서는 효과적이나, 본 프로젝트와 같이 한 번에 수많은 요청이 몰리는 환경에서는 재시도 비용과 처리 지연이 심각한 단점으로 작용했습니다.
비관적 락을 채택하여, 한 번의 트랜잭션 내에서 좌석 재고에 대한 접근을 직렬화함으로써 동시성 문제를 근본적으로 해결하고자 하였습니다.

비관적 락은 동시성을 철저히 보장하지
만, 락 경합으로 인한 성능 저하가 발생할
수 있었습니다.
해결: Redis를 캐시 재고 관리 수단으로
활용하여, DB에 직접 접근하는 횟수를 줄
이고 빠른 응답성을 확보하였습니다. 캐
시를 통한 사전 검증으로 락 경합 문제를
완화하고, 고속 처리를 가능하게 하였습
니다.
문제점 : 캐시와 DB 간 데이터 정합성을
보장하는 로직이 없어 실제 판매된 티켓
과 남은 재고 간 불일치 문제가 발생할 수
있었습니다.


DB와 Redis 간 재고 정합성 유지
문제점: 캐시와 DB 간 데이터 정합성이 떨어질 경우, 실제 판매
된 티켓과 남은 재고 간 불일치 문제가 발생
아웃박스 패턴과 RabbitMQ를 활용한 비동기 이벤트 처리
구현: 모든 재고 감소 이벤트를 아웃박스에 저장하고,
RabbitMQ를 통해 비동기로 처리함으로써, 트랜잭션 내에서의
동기적 처리 부담을 줄였습니다.
비관적 락에 비하여 속도 약 54% 향상 (520ms -> 240ms)


동시성 관리의 복잡성 : 대규모 트래픽 환경에서 한정된 자원(좌석 등)을 안정적으로 관리하는 것이 얼마나 어려운지 체감할 수 있었습니다. 특히 낙관적
락과 비관적 락 각각의 특성과 장단점을 직접 경험하면서, 상황에 맞는 최적의 동시성 제어 전략 선택이 얼마나 중요한지 깨달았습니다.
기술 선택의 중요성 : 다양한 접근 방식을 고려하면서 실제 서비스 환경에 최적화된 기술 스택(예: Redis 캐시, RabbitMQ, 비관적 락 등)을 선택해야 한
다는 점을 배웠습니다. 각 기술이 가진 특성과 trade-off를 명확히 이해하고, 실제 운영 데이터를 기반으로 의사 결정을 내리는 것이 핵심임을 알게 되었
습니다.
부하 테스트의 역할 : 실시간 모니터링 및 부하 테스트의 중요성을 직접 체험했습니다. 예상치 못한 데이터 동기화 문제나 성능 저하 이슈를 조기에 발견
하고 대응할 수 있다는 점에서, 효과적인 모니터링 체계가 프로젝트 안정성에 큰 역할을 한다는 것을 느꼈습니다.
DB와 Redis 간 정합성 강화: 캐시와 DB 간 데이터 정합성을 보다 정확하게 유지할 수 있도록, 자동화된 정합성 검증 및 복구 메커니즘을 도입하는 것이
필요합니다. 주기적인 배치 작업 외에도 실시간 감시 시스템을 보완해야 합니다.

